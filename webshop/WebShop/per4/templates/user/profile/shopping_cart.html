{% extends "user/profile/layout.html" %}
{% load i18n %}
{% load explore %}
{% load url from future %}

{% block center_block_header %}{% trans 'Mein Einkaufskorb'%}{% endblock %}

{% block content %}
<div class="center_box" id="shopping-cart-body" >
    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th width="46" class="top"></th>
                <th width="41" class="top">{% trans 'Article' %}</th>
                <th width="86" class="top">{% trans 'Reference' %}</th>
                <th class="top">{% trans 'Size in MM' %}</th>
                <th width="52" class="top">{% trans 'COLOR' %}</th>
                <th width="66" class="top">{% trans 'Price P/P' %}</th>
                    {% if request.user|has_PricePrivilege %}
                        <th width="5%">{% trans 'DISCOUNT PRICE' %}</th>
                    {% endif %}
                <th width="67" class="top">{% trans 'QUANTITY' %}</th>
                <th width="53" class="top">{% trans 'Total' %}</th>
            </tr>
        <thead>
        <tbody>
            {% for option in cart.items %}
                <tr class="cart-item-row" id="{{ option.id }}">
                    <td><a class="link delete-link" href="{% url "delete-from-cart-route" option.id %}"><img src="/media/images/trash.png"></a></td>
                    <td><img alt="{{ option.article.article_family.ref }}" src="{{ option.article.article_family|check_image_low:option.article.article_family.line.shop.ref }}"/>	</td>
                    <td><a href="/{{ option.article.article_family.line.shop.ref }}/{{ option.article.article_family.line.ref }}/{{ option.article.article_family.id }}/" >{{ option.article.ref }}</a></td>
                    <td>{{ option.article.compiledSize }}</td>
                    <td>{{ option|create_ao_imgtag:option.article.article_family.line.shop.ref }}</td>
                    <td class="pricing"><span>{{ option.price }}</span>&nbsp;&euro;</td>
                    {% if request.user|has_PricePrivilege %}
                        <td class="data discount">{{ option.discount|safe }}</td>
                    {% endif %}
                    <td><input type="text" id="quantityfield_{{ option.id }}" name="{{ option.id }}" class="span1 number cartQtyInput" value="{{ option.quantity }}"
                        maxlength="4"/></td>
                    <td class="total"><span class="articleoption_total">{{ option.total }}</span>&nbsp;&euro;</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="{{ colspan|add:"9" }}"><h3 class="centered">{% trans "Noch keine Artikel hinzugef&uuml;gt!" %}</h3></td>
                </tr>

            {% endfor %}
        </tbody>
        {% with request.user|has_PricePrivilege as colspan %}
            <tfoot class="subTotalBox">
                <tr>
                    <td class="noborder" colspan="{{ colspan|add:"5" }}"></td>
                    <td colspan="2">{% trans "Subtotal" %}</td>
                    <td><span id="totalPrice">{{ cart.total }}</span>&euro;</td>
                </tr>
                <tr>
                    <td class="noborder" colspan="{{ colspan|add:"5" }}"></td>
                    <td align="right" colspan="2">
                    {% ifequal simple_role 'E' %}
                        {% trans "Thereof VAT" %}
                    {% else %}
                        {% trans "VAT" %}
                    {% endifequal %}
                    <span id="taxRate">{{ cart.taxRate }}</span>%</td>
                    <td><span id="taxAmount">
                    {% ifequal simple_role 'E' %}
                        {{ cart.tax_E }}
                    {% else %}
                        {{ cart.tax }}
                    {% endifequal %}
                    </span>&euro;</td>
                </tr>
                <tr>
                    <td class="noborder" colspan="{{ colspan|add:"5" }}"></td>
                    <td colspan="5"><u><a href="/shipping/">{% trans 'Shipping Costs Apply' %}</a></u></td>
                </tr>
                <tr>
                    <td class="noborder" colspan="{{ colspan|add:"5" }}"></td>
                    <td colspan="2">{% trans 'Total' %}:</td>
                    <td colspan="2"><span id="allTotal">
                    {% ifequal simple_role 'E' %}
                        {{ cart.all_total_E }}
                    {% else %}
                        {{ cart.all_total }}
                    {% endifequal %}
                    </span>&euro;</td>
                </tr>
            </tfoot>
        {% endwith %}
    </table>

	<a class="btn {% if cart.items %}refresh-cart-btn{% else %}disabled{% endif %}">{% trans "Save Cart" %}</a>
	<a
        {% if cart.items %}href="{% url "checkout-route" %}"{% endif %}
        class="pull-right btn btn-primary submit-cart-btn {% if not cart.items %}disabled{% endif %}">
            {% trans "Confirm Order" %}</a>
</div>

{% endblock %}

{% block jscripts %}
    <script>
        window.__options__ = {updateCartUrl: "{% url "refresh-cart-route" %}"};
    </script>
    <script src="{{ MEDIA_URL}}scripts/libs/require.js" data-main="{{ MEDIA_URL}}scripts/pages/shopping_cart"></script>
{% endblock %}

{% comment %}
	calcCartPrice = function(){
		calculateRow(0, this);
		updateTotalCartPrice();
	}

	var INTEGER_WARNING = '{% trans 'Please input an integer!' %}';

	function updateTotalCartPrice() {
		lastCol = $('#tbArticles').children('tbody').children('tr').children('td.total').children('span');
		var totalPrice = 0.00;
		for (var i = 0, j = lastCol.length; i < j; i++) {
			totalPrice += parseFloat(lastCol[i].innerHTML);
		}

		var totalPrice = (totalPrice * 100)/100;
		$('#totalPrice').text(parseFloat(totalPrice).toFixed(2));
		var taxAmount = parseFloat($('#taxRate').text())/100 * totalPrice;
		$('#taxAmount').text(taxAmount.toFixed(2));
		$('#allTotal').text( parseFloat(taxAmount + totalPrice).toFixed(2) );
	}

	function saveChanges() {
		var items = $('#tbArticles input.ultramini[value!=0]').serialize();
		$.ajax({
			data : items,
			url: '/user/update_cart/',
			type: 'POST',
			success : function(data, textStatus) {
				window.location.reload();
			},
			error : function(data, textStatus) {
				document.write(data.responseText);
				document.close();
			}});
		}
{% endcomment %}
